<!-- PAGE HEADER -->
<div class="page-header">
  <div class="page-label">Add New Spot</div>
  <h1 class="page-title">Share Your Hidden Corner</h1>
  <p class="page-description">
    Do you have a peaceful place you discovered? Share it with our community and
    help others discover it too.
  </p>
</div>

<!-- FORM CONTAINER -->
<div class="form-container">
  <div class="form-layout">
    <!-- MAIN FORM -->

    <div class="form-section">
      <h2 class="form-section-title">Spot Information</h2>

      <!-- Step Indicator -->
      <div class="step-indicator">
        <div class="step-item" [class.active]="currentStep() === 1" [class.completed]="currentStep() > 1">
          <div class="step-number">1</div>
          <div class="step-label">Location</div>
        </div>
        <div class="step-line" [class.active]="currentStep() > 1"></div>
        <div class="step-item" [class.active]="currentStep() === 2" [class.completed]="currentStep() > 2">
          <div class="step-number">2</div>
          <div class="step-label">Details</div>
        </div>
        <div class="step-line" [class.active]="currentStep() > 2"></div>
        <div class="step-item" [class.active]="currentStep() === 3">
          <div class="step-number">3</div>
          <div class="step-label">Media</div>
        </div>
      </div>

      <!-- Step Content -->
      <div class="step-content">

        @if (currentStep() === 1) {

        <div class="form-group">
          <label class="form-label form-label-required">Spot Name</label>
          <input type="text" class="form-input" [class.error]="errors().name" placeholder="E.g. Çankaya Castle Hill"
            [ngModel]="formData().name" (ngModelChange)="updateField('name', $event)" />
          @if (errors().name) {
          <div class="form-error">{{ errors().name }}</div>
          } @else {
          <div class="form-hint">An explanatory name for your spot</div>
          }
        </div>

        <!-- Map Location Picker -->
        <div class="map-picker">
          <label class="form-label form-label-required">Location</label>
          <div class="form-hint" style="margin-bottom: 10px">
            Click on the map to set the location
          </div>
          <div class="map-container">
            <div id="location-map"></div>
          </div>
          <div class="coordinates-display">
            <div class="coordinate-item">
              <strong>Lat:</strong>
              <span>{{ formData().latitude.toFixed(6) }}</span>
            </div>
            <div class="coordinate-item">
              <strong>Lng:</strong>
              <span>{{ formData().longitude.toFixed(6) }}</span>
            </div>
          </div>
        </div>

        } @else if(currentStep() === 2) {

        <!-- Category -->
        <div class="form-group">
          <label class="form-label form-label-required">Category</label>
          <select class="form-select" [class.error]="errors().type" [ngModel]="formData().type"
            (ngModelChange)="updateField('type', $event)">
            <option [ngValue]="null">Select a category</option>
            @for (type of spotTypes; track type.value) {
            <option [value]="type.value">
              {{ type.emoji }} {{ type.label }}
            </option>
            }
          </select>
          @if (errors().type) {
          <div class="form-error">{{ errors().type }}</div>
          }
        </div>

        <!-- Description -->
        <div class="form-group">
          <label class="form-label form-label-required">Description</label>
          <textarea class="form-textarea" [class.error]="errors().description"
            placeholder="Provide detailed information about your spot. What makes it special? When is it most beautiful?"
            [ngModel]="formData().description" (ngModelChange)="updateField('description', $event)"></textarea>
          @if (errors().description) {
          <div class="form-error">{{ errors().description }}</div>
          } @else {
          <div class="form-hint">At least 50 characters</div>
          }
        </div>

        } @else if (currentStep() === 3) {

        <!-- Image Upload -->
        <div class="image-upload">
          <label class="form-label">Image</label>

          @if (!imagePreview()) {
          <div class="upload-area" (click)="fileInput.click()">
            <svg style="
                width: 48px;
                height: 48px;
                margin: 0 auto;
                display: block;
                color: #c8a96e;
                stroke-width: 1.5;
              " fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <div class="upload-text">Click to upload an image</div>
            <div class="upload-hint">PNG, JPG - Maks 5MB</div>
          </div>
          } @else {
          <div class="image-preview">
            <img [src]="imagePreview()" alt="Preview" />
            <button class="image-remove" (click)="removeImage()">×</button>
          </div>
          }

          <input #fileInput type="file" accept="image/*" style="display: none" (change)="onFileSelected($event)" />
        </div>

        <!-- Address -->
        <div class="form-group">
          <label class="form-label form-label-required">Address</label>
          <input type="text" class="form-input" [class.error]="errors().address" placeholder="E.g. Çankaya, Ankara"
            [ngModel]="formData().address" (ngModelChange)="updateField('address', $event)" />
          @if (errors().address) {
          <div class="form-error">{{ errors().address }}</div>
          } @else {
          <div class="form-hint">General location of your spot</div>
          }
        </div>

        <!-- Best Time -->
        <div class="form-group">
          <label class="form-label">Best Time</label>
          <input type="text" class="form-input" placeholder="E.g. Evening 17:00-19:00" [ngModel]="formData().bestTime"
            (ngModelChange)="updateField('bestTime', $event)" />
          <div class="form-hint">
            Best time to visit your spot (e.g. Morning, Evening)
          </div>
        </div>

        }

      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        @if (currentStep() > 1) {
        <button class="btn-back" (click)="prevStep()">
          Back
        </button>
        }

        @if (currentStep() < 3) { <button class="btn-next" (click)="nextStep()">
          Next
          </button>
          } @else {
          <button class="btn-submit" [disabled]="isSubmitting()" (click)="onSubmit()">
            @if (isSubmitting()) { Adding... } @else { Submit }
          </button>
          }

          <button class="btn-cancel" [disabled]="isSubmitting()" (click)="onCancel()">
            Cancel
          </button>
      </div>
    </div>

    <!-- SIDEBAR PREVIEW -->
    <div class="sidebar-preview">
      <div class="preview-card">
        <div class="preview-header">
          <h3>Preview</h3>
        </div>

        @if (imagePreview()) {
        <div class="preview-image" [style.background]="'none'">
          <img [src]="imagePreview()" alt="Preview" style="width: 100%; height: 100%; object-fit: cover" />
        </div>
        } @else {
        <div class="preview-image"></div>
        }

        <div class="preview-content">
          <h4 class="preview-title">{{ previewTitle() }}</h4>
          <p class="preview-address">{{ previewAddress() }}</p>
          <p class="preview-description">{{ previewDescription() }}</p>

          <div class="preview-meta">
            <div class="preview-meta-item">
              <div class="preview-meta-label">Category</div>
              <div class="preview-meta-value">{{ previewCategory() }}</div>
            </div>
            <div class="preview-meta-item">
              <div class="preview-meta-label">Time</div>
              <div class="preview-meta-value">{{ previewTime() }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>